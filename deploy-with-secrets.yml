# GitHub Actions에 추가할 내용
- name: Update ECS service with secrets
  run: |
    # 태스크 정의에서 이미지 URI 업데이트
    TASK_DEFINITION=$(aws ecs describe-task-definition \
      --task-definition customer-service \
      --query 'taskDefinition')
    
    # 새 이미지 URI로 업데이트
    NEW_TASK_DEFINITION=$(echo $TASK_DEFINITION | jq --arg IMAGE "$ECR_REGISTRY/eatcloud/customer-service:$GITHUB_SHA" \
      '.containerDefinitions[0].image = $IMAGE | del(.taskDefinitionArn) | del(.revision) | del(.status) | del(.requiresAttributes) | del(.placementConstraints) | del(.compatibilities) | del(.registeredAt) | del(.registeredBy)')
    
    # 새 태스크 정의 등록
    aws ecs register-task-definition \
      --cli-input-json "$NEW_TASK_DEFINITION"
    
    # 서비스 업데이트
    aws ecs update-service \
      --cluster $ECS_CLUSTER \
      --service customer-service \
      --task-definition customer-service \
      --force-new-deployment